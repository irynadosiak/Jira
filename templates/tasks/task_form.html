{% extends 'base.html' %}

{% block content %}
<div class="card">
    <h2>{% if task %}Edit Task{% else %}Create New Task{% endif %}</h2>
    
    <form method="post" style="max-width: 600px;">
        {% csrf_token %}
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Title *</label>
            <input type="text" name="title" value="{{ task.title|default:'' }}" required 
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Description</label>
            <textarea name="description" rows="4" 
                      style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; resize: vertical;">{{ task.description|default:'' }}</textarea>
        </div>
        
        {% if task %}
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Status</label>
            <select name="status" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                {% for status_key, status_display in status_choices %}
                <option value="{{ status_key }}" {% if task.status == status_key %}selected{% endif %}>
                    {{ status_display }}
                </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Priority</label>
            <select name="priority" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                {% for priority_key, priority_display in priority_choices %}
                <option value="{{ priority_key }}" {% if task.priority == priority_key %}selected{% endif %}>
                    {{ priority_display }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Assignee</label>
            <select name="assignee" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <option value="">Unassigned</option>
                {% for user in users %}
                <option value="{{ user.id }}" {% if task.assignee_id == user.id %}selected{% endif %}>
                    {{ user.get_full_name|default:user.username }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estimate (Story Points)</label>
            <input type="number" name="estimate" value="{{ task.estimate|default:'' }}" min="1" max="100"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Due Date</label>
            <input type="datetime-local" name="due_date" value="{{ task.due_date|date:'Y-m-d\TH:i'|default:'' }}"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        </div>
        
        <div style="margin-top: 30px;">
            <button type="submit" class="btn">{% if task %}Update Task{% else %}Create Task{% endif %}</button>
            <a href="{% if task %}{% url 'tasks:task-detail' task.pk %}{% else %}{% url 'tasks:task-list' %}{% endif %}" 
               class="btn btn-secondary" style="margin-left: 10px;">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}